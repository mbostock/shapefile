#!/usr/bin/env node

var rw = require("rw"),
    dbfParser = require("../lib/shapefile/dbf-parser");

var reader = rw.fileReader(process.argv[2] || "/dev/stdin"),
    parser = dbfParser().encoding(process.argv[3] || "latin1");

reader.fill(function flow(error) {
  if (error) throw error;
  var data = reader.read(),
      record;

  if (data) parser.push(data);

  while ((record = parser.pop()) != null) {
    console.log(JSON.stringify(record));
  }

  if (reader.ended) return;
  reader.fill(flow);
});
